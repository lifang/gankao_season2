<%= javascript_include_tag 'jquery' %>
<div class="main">
  <div class="m_top">
    <h1 class="ex_paper_h"><%= (@xml[1].nil? or @xml[1].text.nil?) ? "":@xml[1].text %></h1>
    <div class="icon_func">
      <div class="float_right">
        <span class="icon_prev"><a href="javascript:void(0);" class="tooltip" name="上一题" onclick="javascript:prev_problem();">上一题</a></span>
        <span class="icon_next"><a href="javascript:void(0);" class="tooltip" name="下一题" onclick="javascript:next_problem();" >下一题</a></span>
      </div>
    </div>
  </div>
  <script type="text/javascript" >
    //初始化题目号
    var total_problem=<%= @xml[0].size %>;
    if(!(getCookie("show_problem")!= null)){
      setCookie("show_problem","0");
    }
  </script>
  <% str="" %>
  <% @xml[0].each_with_index do |problem,pro_index|  %>
    <div id="single_problem_<%= pro_index %>" style="display:none">
      <div class="m_side m_problem_bg">
        <div class="problem_box">
          <div class="problem_title">第<%=pro_index +1%>题/共<%= @xml[0].size %>题</div>
          <div class="problem_text">
            <%= problem.elements["title"].text %>
          </div>
        </div>
      </div>
      <div class="m_side">
        <div class="problem_box">
          <% problem.get_elements("questions//question").each_with_index do |question,que_index| %>
            <% str += "#{pro_index}_#{que_index};" %>
            <div class="pro_question_list p_q_line" id="<%="#{pro_index}_#{que_index}"%>">
              <div class="pql_left"><%=que_index+1%>.</div>
              <div class="pql_right">
                <div class="pro_qu_t" onclick="javascript:$(this).closest('.pro_question_list').toggleClass('p_q_line');$(this).parent().parent().siblings('.pro_question_list').addClass('p_q_line');">
                  <div class="question_tx"><%= Question::TYPE_NAMES[question.attributes["correct_type"].to_i] %></div>
                  <div class="pro_t_con"><%= (question.elements["description"].nil? or question.elements["description"].text.nil?)? "" :question.elements["description"].text %></div>
                </div>
                <div class="pro_qu_div">
                  <div class="pro_qu_ul">考生答案：<%= question.attributes["user_answer"].nil? ? "": question.attributes["user_answer"]  %></div>
                  <div class="jiexi">
                    <div>正确答案：<span class="red"><%= (question.elements["answer"].nil? or question.elements["answer"].text.nil?)? "": question.elements["answer"].text %></span></div>
                    <div>解析：<%= (question.elements["analysis"].nil? or question.elements["analysis"].text.nil?)? "": question.elements["analysis"].text %></div>
                  </div>
                </div>
              </div>
              <div class="clear"></div>
              <div class="marking_box">
                <% score=(question.attributes["score"].nil? or question.attributes["score"]=='' ) ? 0 :question.attributes["score"].to_i %>
                <div><label>评分：</label><input  type="text" id="score_<%="#{pro_index}_#{que_index}"  %>"/>/<span id="fact_score_<%="#{pro_index}_#{que_index}"%>"><%= score %></span>分</div>
                <div><label>理由：</label><textarea cols="" rows="" id="reason_<%= "#{pro_index}_#{que_index}" %>"></textarea></div>
                <div><button class="t_btn save_score_btn" onclick="javascript:save_score('<%="#{pro_index}_#{que_index}"  %>',<%= score %>)">保存</button></div>
              </div>
            </div>
          <% end %>
        </div>
        <div class="marking_btn"><button class="t_btn green" onclick="javascript:check_compelte()">批改完成</button><button class="t_btn red" onclick="javascript:next_problem()">跳过</button></div>
      </div>
    </div>
  <% end %>
</div>
<input type="hidden" id="questions" value="<%= str.chop %>"/>
<input type="hidden" id="rater_id" value="<%= @reading.id %>"/>
<script type="text/javascript">
  $("#single_problem_"+getCookie("show_problem")).css("display","");
</script>
