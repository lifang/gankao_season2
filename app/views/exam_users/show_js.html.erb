<% category_id = params[:category].nil? ? '2' : params[:category] %>
<script type="text/javascript" >
  //初始化参数
  category = '<%= category_id %>';
  init_problem = 0<%= @sheet.attributes["init"] %>;
  init_exam_user_id ='<%= params[:id] %>';
  init_paper_id = '<%= @paper_id %>';
  sheet_url = '<%= @sheet_url %>';
</script>

<script src="/assets/exam_user/mootools-yui-compressed.js"></script>

<%= javascript_include_tag "#{Constant::BACK_SERVER_PATH}#{@paper.paper_js_url}" %>
<%= javascript_include_tag "#{@answer_url}" %>
<%= javascript_include_tag "/assets/exam_user/init.js" %>
<%= javascript_include_tag "/assets/exam_user/effect.js" %>
<%= javascript_include_tag "/assets/exam_user/generate.js" %>


<!-- 初始化播放器  -->
<%= render :partial=>"/common/flowplayer" %>


<div id="log"></div>
<div class="m_top">
  <h1 class="ex_paper_h"><%= @paper.title %></h1>
  <div class="icon_func">
    <div class="float_right">
      <span class="icon_prev"><a href="javascript:void(0);" class="tooltip" name="上一题" onclick="javascript:click_prev_problem();">上一题</a></span>
      <span class="problem_title"><font id="global_problem_index"><%= @sheet.attributes["init"].to_i+1 %></font>/<font id="global_problem_sum"></font></span>
      <span class="icon_next"><a href="javascript:void(0);" class="tooltip" name="下一题" onclick="javascript:click_next_problem();" >下一题</a></span>
      <span class="icon_big"><a href="javascript:void(0);" class="tooltip" onclick="javascript:ts('body',-1);" name="缩小">缩小</a></span>
      <span class="icon_small"><a href="javascript:void(0);" class="tooltip" onclick="javascript:ts('body',1);" name="放大">放大</a></span>
      <span class="icon_return"><a href="/<%= (params["type"].nil?||(params["type"]!="similarities"&&params["type"]!="specials")) ? "similarities" : params["type"]  %>?category=<%= category_id %>" class="tooltip" name="返回">返回</a></span>
    </div>
    <span class="icon_again"><a href="javascript:void(0);" class="tooltip" name="重做" onclick="javascript:confirm_redo('<%= params["type"] %>');">重做</a></span>
  </div>
</div>

<!-- 试题生成入口 generate.js -->
<div id="generate"></div>

<!-- 相关词汇框 -->
<div id="about_words_loader" style="display:none;">
  <div class="jiexi" id="about_words">
    <span class="xx_x" onclick="javascript:close_about_words();" ><img alt="gankao" src="/assets/x.gif"/></span>
    <div class="xg_words">
      <ul id="about_words_list"></ul>
    </div>
    <div class="xg_words_ny">
      <div class="ch_text">
        <div class="ch_words_line">
          <span class="font_size_24" id='about_word_name'></span>
          <span id='about_word_types'></span><span id='about_word_phonetic'></span>
          <input type="hidden" id="about_word_enunciate_url" />
          <input type="hidden" id="about_word_id" />
          <a href="javascript:void(0);" title="发音" onclick="javascript:play_word_enunciate($('#about_word_enunciate_url').val());"><img alt="gankao" src="/assets/icon_fy.png" /></a>
          <a href="javascript:void(0);" title="加入背诵单词" onclick="javascript:ajax_add_word($('#about_word_id').val());"><img src="/assets/join_bs.png" /></a>
        </div>
        <div class="ch_words_line">
          <p class="font_size_16" id='about_word_en_mean'></p>
          <p id='about_word_ch_mean'></p>
        </div>
        <div class="ch_words_line">
          <ul class="words_ul_font14" id="about_word_sentences"></ul>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 报告错误框  -->
<div class="upErrorTo_tab border_radius" id="report_error" style="top: 242px; left: 450px; display: none; ">
  <span class="xx_x"><img src="/assets/xx.png" onclick="javascript:close_report_error();"/></span>
  <input type="hidden" id="report_error_paper_id" value="<%= @paper_id %>" />
  <input type="hidden" id="report_error_paper_title" value="<%= @paper.title %>" />
  <input type="hidden" id="report_error_user_id" value="<%= cookies[:user_id] %>" />
  <input type="hidden" id="report_error_user_name" value="<%= cookies[:user_name] %>" />
  <input type="hidden" id="report_error_question_id" />
  <h3>错误类型:</h3>
  <ul>
    <li><input name="report_error_radio" class="report_error_radio" type="radio" value="<%= ReportError::TYPE[:TOPOIC] %>"/>题目错误</li>
    <li><input name="report_error_radio" class="report_error_radio" type="radio" value="<%= ReportError::TYPE[:ANSWER] %>"/>答案错误</li>
    <li><input name="report_error_radio" class="report_error_radio" type="radio" value="<%= ReportError::TYPE[:ANALISIS] %>"/>解析错误</li>
    <li><input name="report_error_radio" class="report_error_radio" type="radio" value="<%= ReportError::TYPE[:WORD] %>"/>词汇错误</li>
  </ul>
  <h3>错误说明:</h3>
  <textarea name="" id='report_error_description' cols="" rows="5"></textarea>
  <div><button class="t_btn" onclick="ajax_report_error();">提交</button></div>
</div>

<script type="text/javascript">
  //还原用户之前操作,以及标注收藏过的题
  $(function(){
<% @sheet.each_element do |ele| %>
      $("#refer_btn<%= ele.name %>").trigger("click");
<% end %>
<% @sheet.elements["collection"].text.split(",").each do |str| %>
      $("#shoucang<%= str %>").addClass("hover");
      $("#shoucang<%= str %>").attr("name","已收藏");
      $("#shoucang<%= str %>").attr("onclick","");
<% end if @sheet.elements["collection"] && @sheet.elements["collection"].text %>
  })

</script>

